{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center mt-5">
    <div class="col-md-6 text-center">
        <h2 class="mb-4"><i class="fas fa-qrcode"></i> QR 체크인</h2>
        <div class="card shadow">
            <div class="card-body">
                <p>예약자 전화번호 뒷자리 또는 전체를 입력해주세요.</p>
                <div class="mb-3">
                    <input type="tel" id="checkinPhone" class="form-control form-control-lg text-center"
                        placeholder="01000000000">
                </div>
                <button class="btn btn-success btn-lg w-100" id="btnCheckin">입실 확인</button>
            </div>
        </div>
        <p class="mt-3 text-muted">예약 시간 10분 전부터 체크인 가능합니다.</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('btnCheckin').addEventListener('click', function () {
        const phone = document.getElementById('checkinPhone').value;
        if (!phone) return showAlert('전화번호를 입력해주세요.');

        fetch('/api/checkin', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ phone: phone })
        })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    showAlert(`환영합니다, ${data.name}님! 입실 처리되었습니다.`, function () {
                        window.location.href = '/';
                    });
                } else {
                    showAlert('체크인 실패: ' + data.error);
                }
            });
    });
</script>
{% endblock %}